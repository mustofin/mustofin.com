<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Portofolio | Misbakhul Mustofin</title>
    <link rel="icon" type="image/x-icon" href="https://media.mayar.id/images/0702dec7-5a60-4897-a6ec-69396fde8bc1.jpeg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        .project-image { transition: transform 0.3s ease; }
        .project-image:hover { transform: scale(1.02); }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #2563eb; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 5rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans antialiased text-gray-800 bg-gray-50">
    <div id="navbar-placeholder"></div>

    <main class="container mx-auto px-6 py-12 pt-24">
        <a href="portfolio.html" class="flex items-center text-blue-600 hover:text-blue-800 mb-8">
            <i data-feather="arrow-left" class="mr-2 w-5 h-5"></i> Kembali ke Portofolio
        </a>
        <div id="project-content">
            <div class="loader"></div>
        </div>
    </main>

    <div id="footer-placeholder"></div>
    <script src="scripts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const contentContainer = document.getElementById('project-content');
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id) {
                contentContainer.innerHTML = '<p class="text-center text-red-500">ID Portofolio tidak ditemukan.</p>';
                return;
            }

            const storedItem = JSON.parse(sessionStorage.getItem('selectedPortfolioItem'));

            if (storedItem && storedItem.id == id) {
                console.log("Data dimuat dari sessionStorage.");
                renderContent(storedItem);
                sessionStorage.removeItem('selectedPortfolioItem');
            } else {
                console.log("Data tidak ada di sessionStorage, memanggil API.");
                const apiUrl = `https://script.google.com/macros/s/AKfycbzuQ2vg0P-tCJNm6uGQvuzwFHkoTqYTik6yXcl_xLKtvV-MQXZYeISr2dp1A4RBnf-1ww/exec?id=${id}`;
                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return response.json();
                    })
                    .then(response => {
                        if (response.status === 'success' && response.data) {
                            renderContent(response.data);
                        } else {
                            throw new Error("Data portofolio tidak ditemukan di API.");
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching detail data:', error);
                        contentContainer.innerHTML = `<p class="text-center text-red-500">Gagal memuat detail portofolio. ${error.message}</p>`;
                    });
            }

            // Helper function untuk merender konten section secara dinamis
            function renderSection(title, content, type) {
                if (!title || !content) return '';

                let contentHtml = '';
                const items = Array.isArray(content) ? content : String(content).split(',').map(s => s.trim());

                switch (type) {
                    case 'list':
                        contentHtml = `<ul class="list-disc pl-5 space-y-2 text-gray-600">${items.map(item => `<li>${item}</li>`).join('')}</ul>`;
                        break;
                    case 'tags':
                        contentHtml = `<div class="flex flex-wrap gap-2">${items.map(item => `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${item}</span>`).join('')}</div>`;
                        break;
                    case 'paragraph':
                    default:
                        contentHtml = `<div class="text-gray-600 space-y-2">${content}</div>`;
                        break;
                }

                return `
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">${title}</h3>
                        ${contentHtml}
                    </div>`;
            }

            // Helper function untuk merender lampiran secara dinamis
            function renderAttachments(title, items, type) {
                if (!title || !items) return '';
                
                let itemsHtml = '';
                const itemList = Array.isArray(items) ? items : String(items).split(',').map(s => s.trim());

                switch(type) {
                    case 'gallery':
                        itemsHtml = `<div class="grid grid-cols-2 md:grid-cols-3 gap-4">${itemList.map(img => `<div><a href="${img}" target="_blank" rel="noopener noreferrer"><img src="${img}" alt="Lampiran Gambar" class="w-full h-32 object-cover rounded transition-transform duration-200 hover:scale-105"></a></div>`).join('')}</div>`;
                        break;
                    case 'links':
                        itemsHtml = `<div class="space-y-3">${itemList.map(link => {
                            const parts = link.split('|');
                            const text = parts.length > 1 ? parts[0] : link;
                            const url = parts.length > 1 ? parts[1] : link;
                            return `<div><a href="${url}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline inline-flex items-center"><i data-feather="link" class="w-4 h-4 mr-2"></i>${text}</a></div>`;
                        }).join('')}</div>`;
                        break;
                    default:
                         itemsHtml = '<p class="text-gray-500">Tipe lampiran tidak dikenali.</p>';
                }

                return `
                    <div class="px-8 py-6 bg-gray-100">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">${title}</h3>
                        ${itemsHtml}
                    </div>
                `;
            }

            function renderContent(data) {
                document.title = `${data.title} | Portofolio Mustofin`;
                
                const categoryColors = { /* ... (colors remain the same) ... */ };
                
                const detailsHtml = [
                    (data.detail_1_value ? `<div class="flex items-center mb-4"><i data-feather="${data.detail_1_icon || 'info'}" class="mr-2 text-gray-500"></i><p class="text-gray-500"><span class="font-semibold">${data.detail_1_label}:</span> ${data.detail_1_value}</p></div>` : ''),
                    (data.detail_2_value ? `<div class="flex items-center mb-4"><i data-feather="${data.detail_2_icon || 'info'}" class="mr-2 text-gray-500"></i><p class="text-gray-500"><span class="font-semibold">${data.detail_2_label}:</span> ${data.detail_2_value}</p></div>` : ''),
                    (data.detail_3_value ? `<div class="flex items-center mb-4"><i data-feather="${data.detail_3_icon || 'info'}" class="mr-2 text-gray-500"></i><p class="text-gray-500"><span class="font-semibold">${data.detail_3_label}:</span> ${data.detail_3_value}</p></div>` : '')
                ].join('');

                const section1Html = renderSection(data.section_1_title, data.section_1_content, data.section_1_format);
                const section2Html = renderSection(data.section_2_title, data.section_2_content, data.section_2_format);
                const attachmentHtml = renderAttachments(data.attachment_title, data.attachment_items, data.attachment_type);

                const template = `
                    <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                        <div class="md:flex">
                            <div class="md:w-1/2">
                                <img src="${data.image_cover}" alt="${data.title}" class="w-full h-full object-cover project-image">
                            </div>
                            <div class="p-8 md:w-1/2 flex flex-col">
                                <span class="inline-block px-3 py-1 text-sm font-semibold text-white rounded-full mb-4 self-start ${categoryColors[data.type] || 'bg-gray-500'}">${data.category_label}</span>
                                <h1 class="text-3xl font-bold text-gray-800 mb-4">${data.title}</h1>
                                <div class="flex items-center text-gray-500 mb-6"><i data-feather="calendar" class="mr-2"></i><span>${data.date}</span></div>
                                ${detailsHtml}
                                <div class="text-gray-600 mb-8 space-y-4 flex-grow">${data.description_long}</div>
                                ${section1Html}
                                ${section2Html}
                            </div>
                        </div>
                        ${attachmentHtml}
                    </div>
                `;
                contentContainer.innerHTML = template;
                feather.replace();
            }
        });
    </script>
</body>
</html>